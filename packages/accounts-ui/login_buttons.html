<template name="loginButtons">
  <div id="login-buttons">
    {{#if currentUser}}
      <div class="login-header">
        {{#if currentUser.loading}}
        <div class="loading"></div>
        {{else}}
        {{#if currentUser.name}}
        {{currentUser.name}}
        {{else}}
        {{currentUser.username}}
        {{/if}}
        {{/if}}
      </div>
      <div class="login-button" id="login-buttons-logout">Logout</div>
    {{else}}
      {{#if services}}
        {{#if dropdown}}
          {{> loginButtonsServicesDropdown}}
        {{else}}
          {{> loginButtonsServicesRow}}
        {{/if}}
      {{else}}
        <div class="no-services">No login services configured.</div>
      {{/if}}
    {{/if}}
  </div>
</template>

<template name="loginButtonsServicesRow">
  {{#each services}}
    {{#if isPasswordService}}
      {{#if hasOtherServices}}
        <div class="or">
          <span class="hline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
          <span class="or-text">or</span>
          <span class="hline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
      {{/if}}
      {{#if isForgotPasswordFlow}}
      {{> forgotPasswordForm}}
      {{else}}
      <div class="login-form login-password-form">
        <label id="login-username-label" for="login-username">Username</label>
        <input id="login-username"/>

        <label id="login-password-label" for="login-password">Password</label>
        <input id="login-password" type="password"/>

        {{> loginButtonsServicesRowDynamicPart}}
      </div>
      {{/if}}
    {{else}}
      <div class="login-button" id="login-buttons-{{name}}">
        <div class="login-image" id="login-buttons-image-{{name}}"></div>
        Sign in with {{name}}
      </div>
    {{/if}}
  {{/each}}
</template>

<!-- needed because of a liveui issue. https://app.asana.com/0/974383817758/1275404875524 -->
<template name="loginButtonsServicesRowDynamicPart">
  {{#if inSignupFlow}}
  <label id="login-password-again-label" for="login-password-again">Password (again)</label>
  <input id="login-password-again" type="password"/>
  {{/if}}

  {{> loginButtonsMessages}}

  <div class="login-button login-button-form-submit" id="login-buttons-password">
    {{#if inSignupFlow}}
    Create account
    {{else}}
    Sign in
    {{/if}}
  </div>

  {{#if inLoginFlow}}
  <div class="additional-link-container">
    <a id="signup-link" class="additional-link">Create account</a>
  </div>

  <div class="additional-link-container">
    <a id="forgot-password-link" class="additional-link">Forgot password</a>
  </div>
  {{/if}}
</template>

<template name="loginButtonsMessages">
  {{#if errorMessage}}
  <div class="message error-message">{{errorMessage}}</div>
  {{/if}}
  {{#if infoMessage}}
  <div class="message info-message">{{infoMessage}}</div>
  {{/if}}
</template>

<template name="loginButtonsServicesDropdown">
  <div class="login-link-and-dropdown-list">
    <a class="login-link-text">Sign in</a>
    {{#if dropdownVisible}}
    <div id="login-dropdown-list" class="accounts-dialog">
      <a class="login-close-text">Close</a>
      <div class="login-close-text-clear"></div>
      {{> loginButtonsServicesRow}}
    </div>
    {{/if}}
  </div>
</template>

<template name="forgotPasswordForm">
  <div class="login-form">
    <label id="forgot-password-email-label" for="forgot-password-email">Email</label>
    <input id="forgot-password-email"/>

    {{> loginButtonsMessages}}

    <div class="login-button login-button-form-submit" id="login-buttons-forgot-password">
      Reset password
    </div>
  </div>
</template>

<template name="resetPasswordForm">
  {{#if inResetPasswordFlow}}
  <div class="hide-background"></div>

  <div id="reset-password-form" class="accounts-dialog">
    <label id="reset-password-new-password-label" for="reset-password-new-password">
      New password
    </label>

    <div>
      <input id="reset-password-new-password" />
    </div>

    {{> loginButtonsMessages}}

    <div class="login-button login-button-form-submit" id="login-buttons-reset-password-button">
      Reset password
    </div>

    <a class="additional-link" id="login-buttons-cancel-reset-password">
      Cancel
    </a>
  </div>
  {{/if}}
</template>

<body>
  {{> resetPasswordForm}}
</body>
